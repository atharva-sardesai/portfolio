version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
        # Create a temporary directory for the Medium fetcher
        - mkdir -p temp/medium-fetcher
        - echo '{"dependencies":{"rss-parser":"^3.13.0"}}' > temp/medium-fetcher/package.json
        - cd temp/medium-fetcher
        - npm install
        # Create the fetch script
        - |
          echo 'const Parser = require("rss-parser");
          const fs = require("fs").promises;
          const path = require("path");
          
          async function fetchPosts() {
            try {
              console.log("Fetching posts from Medium...");
              const parser = new Parser();
              const feed = await parser.parseURL("https://medium.com/feed/@cyberwithatharva");
              
              const posts = feed.items
                .filter(item => item.title && item.content && item.pubDate && item.link && item.guid)
                .map(item => ({
                  title: item.title,
                  content: item.content,
                  pubDate: item.pubDate,
                  link: item.link,
                  guid: item.guid,
                  lastUpdated: new Date().toISOString()
                }));
              
              await fs.writeFile("../../public/medium-posts.json", JSON.stringify({ posts }, null, 2));
              console.log("Posts updated successfully");
            } catch (error) {
              console.error("Error:", error);
              process.exit(1);
            }
          }
          
          fetchPosts();' > fetch-posts.js
        # Run the fetch script
        - node fetch-posts.js
        - cd ../..
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/* 